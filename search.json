[{"path":"https://projects.indicatrix.org/gtfsrealtime-r/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2026 Matthew Bhagat-Conway Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/archived.html","id":"the-data","dir":"Articles","previous_headings":"","what":"The data","title":"Working with archived data","text":"plot chunk unnamed-chunk-12 vignette, work one day archived GTFS-realtime position data MTA New York City Transit Bus realtime feed. positions course day shown ; end vignette see make animation. data large include gtfsrealtime package, available download . R code download unzip one day GTFS-realtime vehicle position files, place directory nyc-bus-demo current working directory.","code":"suppressMessages({   if (!dir.exists(\"nyc-bus-demo\")) {     zipfile = tempfile(fileext = \".zip\")      download.file(       \"https://files.indicatrix.org/gtfsrealtime-r/nyc-bus-demo.zip\",       zipfile     )      unzip(zipfile, exdir=\".\")     file.remove(zipfile)   } })"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/archived.html","id":"load-libraries","dir":"Articles","previous_headings":"","what":"Load libraries","title":"Working with archived data","text":"Next, need load libraries. use quite different libraries vignette; required every analysis. ggplot2, dplyr, lubridate, purrr part tidyverse alternately loaded library(tidyverse). Next, read multiple GTFS-realtime files, stack together. 1,440 GTFS-realtime files, 3:00 local time January 28, 2026 2:59 local time January 29. use Sys.glob function match multiple files - case, every vehicle position file nyc-bus-demo. * means “anything”, match file starts nyc-bus-demo/vehicle-positions- ends .pb.bz2. (.pb.bz2 means Protocol Buffers file, underlying format GTFS-realtime, compressed using bzip2. ‘gtfsrealtime’ can load files compressed gzip bzip2 directly). use map function ‘purrr’ apply function file name, rbindlist function stack records single data.table. GTFS-realtime include time zone information; times specified UTC. specify time zone times automatically converted local time. Time zones specified standardized TZ database format (generally Continent/City; list, see ). want convert times, can specify time zone Etc/UTC. \\(f) read_gtfsrt_positions(f, \"America/New_York\") creates anonymous function - , function without name - takes input filename (calls f) runs read_gtfsrt_positions function filename first argument, US eastern time (America/New_York) second.","code":"library(gtfsrealtime) library(purrr) library(data.table) library(dplyr) library(tidyr) library(lubridate) library(sf) library(ggplot2) library(gifski)"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/archived.html","id":"read-data","dir":"Articles","previous_headings":"","what":"Read data","title":"Working with archived data","text":"read 2.8 million vehicle observations:","code":"positions = map(     Sys.glob(\"nyc-bus-demo/vehicle-positions-*.pb.bz2\"),     \\(f) read_gtfsrt_positions(f, \"America/New_York\")   ) |>   rbindlist()  head(positions) ##               id latitude longitude  bearing odometer speed                            trip_id route_id direction_id ##           <char>    <num>     <num>    <num>    <num> <num>                             <char>   <char>        <num> ## 1: MTA NYCT_7116 40.67004 -73.84773 343.8108       NA    NA  EN_A6-Weekday-SDon-013500_B15_103      B15            0 ## 2: MTA NYCT_8446 40.70428 -73.79269 310.4622       NA    NA   JA_A6-Weekday-SDon-016700_Q5_201       Q5            0 ## 3: MTA NYCT_9760 40.74069 -73.99020 234.0276       NA    NA   MV_A6-Weekday-SDon-013000_M2_202       M2            1 ## 4: MTA NYCT_7160 40.71404 -73.95068 359.4692       NA    NA         FP_M6-Weekday-017500_L90_5      L90            0 ## 5: MTA NYCT_5314 40.81609 -73.91773 341.5651       NA    NA WF_A6-Weekday-SDon-015000_BX19_301     BX19            0 ## 6: MTA NYCT_5338 40.86142 -73.89084 329.7436       NA    NA  KB_A6-Weekday-SDon-015500_BX9_601      BX9            1 ##    start_time start_date schedule_relationship stop_id current_stop_sequence current_status           timestamp ##        <char>     <char>                <fctr>  <char>                 <num>         <fctr>              <POSc> ## 1:       <NA>   20260128                  <NA>  904253                    NA           <NA> 2026-01-28 03:00:26 ## 2:       <NA>   20260128                  <NA>  503967                    NA           <NA> 2026-01-28 03:00:24 ## 3:       <NA>   20260128                  <NA>  400330                    NA           <NA> 2026-01-28 03:00:06 ## 4:       <NA>   20260128                  <NA>  302319                    NA           <NA> 2026-01-28 03:00:02 ## 5:       <NA>   20260128                  <NA>  103748                    NA           <NA> 2026-01-28 03:00:24 ## 6:       <NA>   20260128                  <NA>  104102                    NA           <NA> 2026-01-28 03:00:02 ##    congestion_level     occupancy_status occupancy_percentage    vehicle_id vehicle_label vehicle_license_plate ##              <fctr>               <fctr>                <num>        <char>        <char>                <char> ## 1:             <NA> MANY_SEATS_AVAILABLE                   NA MTA NYCT_7116          <NA>                  <NA> ## 2:             <NA>                 <NA>                   NA MTA NYCT_8446          <NA>                  <NA> ## 3:             <NA>                 <NA>                   NA MTA NYCT_9760          <NA>                  <NA> ## 4:             <NA>                 <NA>                   NA MTA NYCT_7160          <NA>                  <NA> ## 5:             <NA>                 <NA>                   NA MTA NYCT_5314          <NA>                  <NA> ## 6:             <NA>                 <NA>                   NA MTA NYCT_5338          <NA>                  <NA> nrow(positions) ## [1] 2825902"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/archived.html","id":"clean-data","dir":"Articles","previous_headings":"","what":"Clean data","title":"Working with archived data","text":"observations duplicates, every bus reports every minute. can identify based timestamp vehicle ID, go single record per report. uses ‘data.table’ syntax, somewhat obtuse ‘tidyverse’, orders magnitude faster - important large datasets . syntax groups timestamp vehicle ID (last part). takes first row SubDataset (.SD[1]). Note , least New York data, sometimes multiple reports timestamp vehicle ID different locations. type data error, just pick first reported position given time. timestamp column Unix timestamp, measuring seconds since January 1, 1970 00:00:00 UTC. convert datetime object, adjust timezone, since Unix time always recorded UTC. data spatial, can convert sf object remaining spatial analyses. data GTFS realtime always WGS 84 latitude/longitude, specify CRS 4326 creating dataset, immediately project 32118, State Plane New York Long Island.","code":"positions = positions[, .SD[1], by = c(\"timestamp\", \"vehicle_id\")] positions[, timestamp := with_tz(as_datetime(timestamp), \"America/New_York\")] positions = positions |>   st_as_sf(coords=c(\"longitude\", \"latitude\"), crs=4326) |>   st_transform(32118)"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/archived.html","id":"getting-a-snapshot-state-at-any-given-time","dir":"Articles","previous_headings":"","what":"Getting a snapshot state at any given time","title":"Working with archived data","text":"get positions vehicles given time, want grab position reports within (say) last five minutes, get recent one vehicle. can write function : can use function get vehicle positions 8 day data collected: plot positions: plot chunk unnamed-chunk-9","code":"snapshot_positions = function (positions, time, tolerance_mins=5) {   # sf uses tidyverse syntax rather than data.table   positions |>     filter(timestamp <= time & timestamp >= time - minutes(tolerance_mins)) |>     group_by(vehicle_id) |>     slice_max(timestamp) } # note! important to specify correct time zone pos_8am = snapshot_positions(positions, ymd_hms(\"2026-01-28 8:00:00\", tz = \"America/New_York\")) ggplot(pos_8am) +   geom_sf() +   # theme_void removes all plot elements   theme_void()"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/archived.html","id":"animating-positions","dir":"Articles","previous_headings":"","what":"Animating positions","title":"Working with archived data","text":"Now get making figure saw top. render one “frame” (plot bus locations) minute, use gifski convert animated GIF. First, create temporary directory hold frames: Next, render plots image files directory, one time. data 3am NYC time 2026-01-28 3am 2026-01-29, 1,440 frames one minute apart. Lastly, render frames created animated GIF: plot chunk unnamed-chunk-12 finally, clean removing temporary directory.","code":"framedir = tempfile() dir.create(framedir) # as.list is necessary to preserve column type: # https://stackoverflow.com/questions/77838146 times = as.list(ymd_hms(\"2026-01-28 03:00:00\", tz=\"America/New_York\") + minutes(0:1440))  # get the bounding box of all positions over the course # of the day, so that every frame has the same extent bbox = st_bbox(positions)  for (time in times) {   current_pos = snapshot_positions(positions, time)   p = ggplot(current_pos) +     theme_void() +     geom_sf(size=0.3) +     xlim(bbox$xmin, bbox$xmax) +     ylim(bbox$ymin, bbox$ymax) +     # add the current time as the title     ggtitle(format(time, \"%B %d, %H:%M\"))    # save the frame, using the Unix timestamp in the filename   ggsave(     file.path(framedir, paste0(\"time\", as.numeric(time), \".png\")),     width=4, height=4, dpi=100, bg=\"white\", plot = p) } gifski(   list.files(framedir, full.names=TRUE),   \"figures/nyc_bus_anim.gif\",   # twenty minutes per second   delay = 1 / 20,   # match resolution of input files (4 in by 4 in at 100 dpi)   width = 400,   height = 400 ) ## Error in gifski(list.files(framedir, full.names = TRUE), \"figures/nyc_bus_anim.gif\", : Target directory does not exist:figures unlink(framedir, recursive=TRUE)"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/archived.html","id":"extracting-trajectories","dir":"Articles","previous_headings":"","what":"Extracting trajectories","title":"Working with archived data","text":"can also extract trajectories particular vehicles took course day. grouping vehicle ID (also group trip ID get single runs), summarizing converting combined points linestring (line feature). quite slow, seems related use st_cast; issue needs investigation. can plot trajectories course day: plot chunk unnamed-chunk-15 extract single trajectory: plot chunk unnamed-chunk-16 extract single trajectory combine times: plot chunk unnamed-chunk-17","code":"trajectories = positions |>   arrange(vehicle_id, trip_id, timestamp) |>   group_by(vehicle_id, trip_id) |>   summarize(do_union=FALSE) |>   st_cast(\"LINESTRING\") ## `summarise()` has grouped output by 'vehicle_id'. You can override using the `.groups` argument. ggplot(trajectories) +   theme_void() +   geom_sf() ggplot(trajectories[2, ]) +   theme_void() +   geom_sf() trajectory = trajectories[2, ] points = positions |>   filter(vehicle_id == trajectory$vehicle_id & trip_id == trajectory$trip_id)  ggplot() +   geom_sf(data=trajectory) +   geom_sf(data=points) +   # label the times the bus reached each point   geom_sf_label(     data=points,     aes(label=format(timestamp, \"%H:%M\")),     position = position_nudge(x=120)   ) +   theme_void()"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/positions.html","id":"load-libraries","dir":"Articles","previous_headings":"","what":"Load libraries","title":"Vehicle positions","text":"First, need load libraries. using {gtfsrealtime} package, well {ggplot2} package mapping.","code":"library(gtfsrealtime) library(ggplot2)"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/positions.html","id":"load-a-gtfs-realtime-vehicle-positions-feed","dir":"Articles","previous_headings":"","what":"Load a GTFS-realtime vehicle positions feed","title":"Vehicle positions","text":"feed comes New York City bus network. file included {gtfsrealtime} bzipped save space. {gtfsrealtime} can automatically detect read uncompressed files well compressed gzip bzip2. as_sf tells {gtfsrealtime} load positions {sf} object rather plain data frame. GTFS-realtime include time zone information; times specified UTC. specify time zone times automatically converted local time. Time zones specified standardized TZ database format (generally Continent/City; list, see ). want convert times, can specify time zone Etc/UTC.","code":"positions = read_gtfsrt_positions(   system.file(\"nyc-vehicle-positions.pb.bz2\", package = \"gtfsrealtime\"),   \"America/New_York\",   as_sf = TRUE )"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/positions.html","id":"explore-the-feed","dir":"Articles","previous_headings":"","what":"Explore the feed","title":"Vehicle positions","text":"can get idea feed looks like. hierarchical GTFS-realtime vehicle position flattened tabular format R best suited , otherwise shows data available feed status individual carriages trains (map neatly tabular format).","code":"head(positions) ## Simple feature collection with 6 features and 20 fields ## Geometry type: POINT ## Dimension:     XY ## Bounding box:  xmin: -73.95419 ymin: 40.6589 xmax: -73.78681 ymax: 40.87092 ## Geodetic CRS:  WGS 84 ##              id   bearing odometer speed                             trip_id ## 1 MTA NYCT_9771  55.21397       NA    NA    MV_A6-Weekday-SDon-110100_M5_527 ## 2 MTA NYCT_8440 113.49857       NA    NA   JA_A6-Weekday-SDon-110800_Q17_334 ## 3 MTA NYCT_9770 152.70042       NA    NA GH_A6-Weekday-SDon-111400_BX238_640 ## 4 MTA NYCT_7112  19.17901       NA    NA   EN_A6-Weekday-SDon-108800_B15_142 ## 5 MTA NYCT_8443 293.74948       NA    NA   JA_A6-Weekday-SDon-113200_Q17_317 ## 6 MTA NYCT_9775 248.07346       NA    NA    MV_A6-Weekday-SDon-113200_M4_454 ##   route_id direction_id start_time start_date schedule_relationship stop_id ## 1       M4            0       <NA>   20260121                  <NA>  400041 ## 2      Q17            0       <NA>   20260121                  <NA>  501341 ## 3     BX28            1       <NA>   20260121                  <NA>  101927 ## 4      B15            0       <NA>   20260121                  <NA>  301136 ## 5      Q17            1       <NA>   20260121                  <NA>  501369 ## 6       M4            1       <NA>   20260121                  <NA>  400645 ##   current_stop_sequence current_status           timestamp congestion_level ## 1                    NA           <NA> 2026-01-21 18:58:29             <NA> ## 2                    NA           <NA> 2026-01-21 18:58:24             <NA> ## 3                    NA           <NA> 2026-01-21 18:58:32             <NA> ## 4                    NA           <NA> 2026-01-21 18:58:05             <NA> ## 5                    NA           <NA> 2026-01-21 18:58:32             <NA> ## 6                    NA           <NA> 2026-01-21 18:58:06             <NA> ##       occupancy_status occupancy_percentage    vehicle_id vehicle_label ## 1   STANDING_ROOM_ONLY                   NA MTA NYCT_9771          <NA> ## 2                 <NA>                   NA MTA NYCT_8440          <NA> ## 3 MANY_SEATS_AVAILABLE                   NA MTA NYCT_9770          <NA> ## 4  FEW_SEATS_AVAILABLE                   NA MTA NYCT_7112          <NA> ## 5                 <NA>                   NA MTA NYCT_8443          <NA> ## 6 MANY_SEATS_AVAILABLE                   NA MTA NYCT_9775          <NA> ##   vehicle_license_plate                   geometry ## 1                  <NA>  POINT (-73.95419 40.7872) ## 2                  <NA> POINT (-73.78681 40.74109) ## 3                  <NA> POINT (-73.84709 40.87092) ## 4                  <NA>  POINT (-73.89967 40.6589) ## 5                  <NA> POINT (-73.82975 40.75879) ## 6                  <NA> POINT (-73.93855 40.85025)"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/articles/positions.html","id":"map-the-feed","dir":"Articles","previous_headings":"","what":"Map the feed","title":"Vehicle positions","text":"Since requested spatial object (as_sf = TRUE) reading positions, can also map positions. color based occupancy. see outline New York City current bus positions.","code":"positions |>   ggplot(aes(color=occupancy_status)) +     geom_sf() +     theme_minimal()"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Matthew Bhagat-Conway. Author, maintainer, copyright holder.","code":""},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Bhagat-Conway M (2026). gtfsrealtime: Read GTFS-realtime files data frames, fast. R package version 0.0.2, http://projects.indicatrix.org/gtfsrealtime-r/.","code":"@Manual{,   title = {gtfsrealtime: Read GTFS-realtime files into data frames, fast},   author = {Matthew Bhagat-Conway},   year = {2026},   note = {R package version 0.0.2},   url = {http://projects.indicatrix.org/gtfsrealtime-r/}, }"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/index.html","id":"gtfsrealtime","dir":"","previous_headings":"","what":"{gtfsrealtime}","title":"Read GTFS-realtime files into data frames, fast","text":"Fast library read GTFS-realtime files R data frames.","code":""},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Read GTFS-realtime files into data frames, fast","text":"package installable mattwigway.r-universe.dev. Run following R prompt: want build source, package contains compiled extendr Rust code efficiently read GTFS-realtime. need Rust development environment; can build Rust code running rextendr::document().","code":"install.packages('gtfsrealtime', repos = c('https://mattwigway.r-universe.dev', 'https://cloud.r-project.org'))"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/index.html","id":"usage","dir":"","previous_headings":"","what":"Usage","title":"Read GTFS-realtime files into data frames, fast","text":"See vignette walkthrough working vehicle position feeds. Working alerts trip updates similar; see documentation relevant functions Reference tab. GTFS-realtime hierarchical format, R data frames flat tables. Thus, single trip update alert become multiple rows output, common id. See individual function documentation details.","code":""},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/gtfsrealtime-package.html","id":null,"dir":"Reference","previous_headings":"","what":"gtfsrealtime: Read GTFS-realtime files into data frames, fast — gtfsrealtime-package","title":"gtfsrealtime: Read GTFS-realtime files into data frames, fast — gtfsrealtime-package","text":"GTFS-realtime format transit agencies use provide current vehicle positions, predicted arrival times, service alerts. package provides efficient functions read format data frames. can used retrieve current data process archived data.","code":""},{"path":[]},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/gtfsrealtime-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"gtfsrealtime: Read GTFS-realtime files into data frames, fast — gtfsrealtime-package","text":"Maintainer: Matthew Bhagat-Conway mwbc@unc.edu [copyright holder]","code":""},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/read_gtfsrt_alerts.html","id":null,"dir":"Reference","previous_headings":"","what":"Read GTFS-realtime alerts — read_gtfsrt_alerts","title":"Read GTFS-realtime alerts — read_gtfsrt_alerts","text":"function reads GTFS realtime alerts. Alerts hierarchical: single alert can multiple applicability periods, multiple affected entities, translations multiple languages. function flattens tabular format, one row every combination applicability, entity, language. rows single alert can identified common id.","code":""},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/read_gtfsrt_alerts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read GTFS-realtime alerts — read_gtfsrt_alerts","text":"","code":"read_gtfsrt_alerts(filename)"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/read_gtfsrt_alerts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read GTFS-realtime alerts — read_gtfsrt_alerts","text":"filename filename read. Can uncompressed compressed gzip bzip2. Can also http:// https:// URL.","code":""},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/read_gtfsrt_positions.html","id":null,"dir":"Reference","previous_headings":"","what":"Read GTFS-realtime vehicle positions into a data frame — read_gtfsrt_positions","title":"Read GTFS-realtime vehicle positions into a data frame — read_gtfsrt_positions","text":"Read GTFS-realtime vehicle positions data frame","code":""},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/read_gtfsrt_positions.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read GTFS-realtime vehicle positions into a data frame — read_gtfsrt_positions","text":"","code":"read_gtfsrt_positions(filename, timezone, as_sf = FALSE)"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/read_gtfsrt_positions.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read GTFS-realtime vehicle positions into a data frame — read_gtfsrt_positions","text":"filename filename read. Can uncompressed compressed gzip bzip2. Can also http:// https:// URL. timezone timezone feed, Olson format. Times GTFS-realtime stored Unix time UTC; option convert local times. want read times UTC, specify \"Etc/UTC\" as_sf return sf (spatial) object rather data frame.","code":""},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/read_gtfsrt_trip_updates.html","id":null,"dir":"Reference","previous_headings":"","what":"Read GTFS-realtime trip updates — read_gtfsrt_trip_updates","title":"Read GTFS-realtime trip updates — read_gtfsrt_trip_updates","text":"Note trip update becomes multiple rows, one per stop time update, trip_id, etc., duplicated row. column id can used identify rows came trip update.","code":""},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/read_gtfsrt_trip_updates.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read GTFS-realtime trip updates — read_gtfsrt_trip_updates","text":"","code":"read_gtfsrt_trip_updates(filename)"},{"path":"https://projects.indicatrix.org/gtfsrealtime-r/reference/read_gtfsrt_trip_updates.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read GTFS-realtime trip updates — read_gtfsrt_trip_updates","text":"filename filename read. Can uncompressed compressed gzip bzip2. Can also http:// https:// URL.","code":""}]
